{% extends "portfolio/base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}{{ asset_type_display }} - Financial Portfolio Tracker{% endblock %}

{% block content %}
<h1 class="custom-h1">Your {{ asset_type_display }}</h1>

<div class="bg-white p-6 rounded shadow mb-6 flex justify-between items-center">
    <div class="total-value">
        Total {{ asset_type_display }} Value: <span id="portfolio-value" class="font-bold">${{ total_value|floatformat:2 }}</span>
    </div>
    <div class="asset-type-filter">
        <button id="filterButton" class="filter-button">
            Filter: {{ button_text }}
        </button>
    </div>
</div>

<div class="bg-white p-6 rounded shadow">
    <table class="w-full">
        <thead>
            <tr>
                <th><a href="?sort=symbol&asset_type={{ current_filter }}">Symbol</a></th>
                <th><a href="?sort=name&asset_type={{ current_filter }}">Name</a></th>
                <th><a href="?sort=asset_type&asset_type={{ current_filter }}">Type</a></th>
                <th><a href="?sort=quantity&asset_type={{ current_filter }}">Quantity</a></th>
                <th><a href="?sort=current_price&asset_type={{ current_filter }}">Current Price</a></th>
            </tr>
        </thead>
        <tbody>
            {% for asset in assets %}
            <tr>
                <td>{{ asset.symbol }}</td>
                <td>{{ asset.name }}</td>
                <td>{{ asset.get_asset_type_display }}</td>
                <td>{{ asset.quantity|display_decimal }}</td>
                <td>${{ asset.current_price|default_if_none:"N/A"|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No assets found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.getElementById('filterButton').addEventListener('click', function() {
        const assetTypes = ['all', 'stock', 'crypto', 'commodity'];
        const currentFilter = '{{ current_filter }}';
        const currentIndex = assetTypes.indexOf(currentFilter);
        const nextIndex = (currentIndex + 1) % assetTypes.length;
        const nextFilter = assetTypes[nextIndex];
        
        // Update the URL and reload the page
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('asset_type', nextFilter);
        window.location.href = currentUrl.toString();
    });
</script>
{% endblock %}